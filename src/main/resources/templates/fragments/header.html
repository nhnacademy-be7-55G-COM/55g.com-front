<!--<head>-->
<!--  <style>-->
<!--    .scrollable-category {-->
<!--      max-height: 300px; /* 최대 높이 */-->
<!--      overflow-y: auto; /* 세로 방향 스크롤바 */-->
<!--      overflow-x: hidden; /* 가로 방향 스크롤 제거 */-->
<!--      border: 1px solid #ccc; /* 선택사항: 테두리 */-->
<!--      padding: 10px; /* 선택사항: 내부 여백 */-->
<!--      margin: 10px 0; /* 선택사항: 외부 여백 */-->
<!--    }-->
<!--  </style>-->
<!--</head>-->

<div id="header-wrap">
  <form id="logout-form" th:action="@{/logout}" method="post" style="display:none;">
    <button type="submit">Logout</button>
  </form>
  <header id="header" style="padding: 0">
    <div class="container-fluid">
      <!--      <div class="row">-->
      <div class="d-flex justify-content-between align-items-center">

        <div class="d-flex" id="headerLeftSide">
          <div class="main-logo d-flex" style="margin: 8px 0">
            <a href="/" class="my-auto"><img class="my-auto" src="/static/images/main-logo.png" alt="logo" style="width: 100px;"></a>
          </div>

        </div>

        <div id="headerCenterSide" class="d-flex">

          <nav id="navbar" class="my-auto">
            <div class="main-menu stellarnav">
              <ul class="menu-list">
                <!--                <li class="menu-item active"><a href="#home">Home</a></li>-->

                <li class="menu-item active"><a href="/book/list">Book</a></li>

                <li class="menu-item has-sub">
                  <button class="nav-link">Category</button>
                  <ul id="unique-category-list" class="scrollable-category hidden">
                    <!-- JavaScript로 카테고리를 동적으로 추가 -->
                  </ul>
                </li>

                <!--                <li class="menu-item"><a href="#featured-books" class="nav-link">Featured</a></li>-->
                <!--                <li class="menu-item"><a href="#popular-books" class="nav-link">Popular</a></li>-->
              </ul>
              <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </div>
            </div>
          </nav>
        </div>
        <div class="d-flex">
          <nav id="navbar2">
            <div class="main-menu stellarnav">
              <ul class="menu-list">

                <li>
                  <a href="#" th:if="${isLoggedIn}" class="user-account for-buy" onclick="document.getElementById('logout-form').submit();">
                    <i class="icon icon-user"></i><span id="account-text2">Logout</span>
                  </a>
                  <a href="/login" th:unless="${isLoggedIn}" id="account-button" class="user-account for-buy">
                    <i class="icon icon-user"></i><span id="account-text1">Login</span>
                  </a>
                </li>
                <!-- 마이 페이지 링크 (로그인 상태일 때만 표시) -->
                <li><a href="/mypage" th:if="${isLoggedIn}" class="user-account for-buy">
                  <i class="icon icon-user"></i><span>My Page</span>
                </a></li>
                <li>
                  <button style="height:2rem; padding: 0 1.4rem" class="cart for-buy" onclick="loadCartPage()">
                    <span class="cart-text">Cart</span>
                    <span class="cart-count-badge" id="cart-count">0</span>
                  </button>
                </li>
              </ul>
            </div>
          </nav>
        </div>

      </div>
    </div>

    <script>
      async function loadCartPage() {

        const loggedIn = await isLoggedIn();
        console.log('cartPage load')

        if (loggedIn) {
          window.location.href = "/cart/detailPage";
          return;
        }
        if (!localStorage.getItem('cart')){
          localStorage.setItem('cart', JSON.stringify({ cartBookInfoList: [] }));
          localStorage.setItem('cartCount',0);

        }
        const books = localStorage.getItem('cart');
        const encodedBooks = encodeURIComponent(btoa(books));
        window.location.href = `/cart/detailPage?cartBookInfoList=${encodedBooks}`;

      }

      async function updateCartCount() {
        console.log('update Cart Count start in header.html');
        const loggedIn = await isLoggedIn();

        if (!loggedIn){
          // 비로그인 상태에서는 localStorage 에서 항목 수 확인
          if (!localStorage.getItem('cart')){
            localStorage.setItem('cart', JSON.stringify({ cartBookInfoList: [] }));
            localStorage.setItem('cartCount',0);
          }
        }

        // DOM 업데이트
        const cartCountElement = document.getElementById('cart-count');
        cartCountElement.textContent = localStorage.getItem('cartCount');

      }

      // 쿠키를 이용해 로그인 여부 확인인데 http only 라서 자바스크립트에서는 쿠키를 직접 확인할 수 없고 서버에 요청을 해야한다.
      async function isLoggedIn() {
        const response = await fetch("/cart/loginCheck",{method:'GET',credentials:"include"});
        const data = await response.json();
        return  data.isLoggedIn;
      }


      window.addEventListener('DOMContentLoaded', async () => await updateCartCount());

      document.addEventListener("DOMContentLoaded", () => {
        const categoryList = document.getElementById("unique-category-list");

        if (categoryList) {
          // 기본 숨기기
          categoryList.style.display = "none";

          // Category 버튼에 hover 이벤트 추가
          const categoryMenuItem = categoryList.closest(".menu-item.has-sub");

          // 마우스를 올리면 카테고리 리스트 표시
          categoryMenuItem.addEventListener("mouseenter", () => {
            categoryList.style.display = "grid"; // 그리드 레이아웃 사용
          });

          // 마우스를 떼면 카테고리 리스트 숨기기
          categoryMenuItem.addEventListener("mouseleave", () => {
            categoryList.style.display = "none";
          });
        }

        // 카테고리 데이터를 로드
        categoryInfo();
      });

      async function categoryInfo() {
        console.log("Loading Categories...");
        try {
          const response = await fetch("/category", { method: "GET" });
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const categories = await response.json();

          const categoryList = document.getElementById("unique-category-list");
          if (!categoryList) {
            console.error("Error: #unique-category-list element not found.");
            return;
          }

          // 기존 항목 제거
          categoryList.innerHTML = "";

          // 카테고리 데이터를 기반으로 리스트 추가
          categories.forEach((category) => {
            const listItem = document.createElement("li");
            const link = document.createElement("a");

            // 링크 속성 설정
            link.href = `/book/list/category?name=${encodeURIComponent(category.categoryName)}`;
            link.textContent = category.categoryName;

            listItem.appendChild(link);
            categoryList.appendChild(listItem);
          });

          console.log("Categories loaded successfully.");
        } catch (error) {
          console.error("Error fetching categories:", error);
        }
      }
    </script>
  </header>

</div><!--header-wrap-->




