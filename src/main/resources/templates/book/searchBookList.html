<!DOCTYPE html>
<html lang="en">
<head>
  <th:block th:replace="~{fragments/head :: headTemplate}"></th:block>
  <title>Book List</title>
  <meta charset="utf-8" />
  <style>
    /* book-info 영역 스타일 */
    .book-info {
      width: 300px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-sizing: border-box;
    }

    /* 일반 텍스트 요소 스타일 */
    .truncate-fixed {
      display: block;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      box-sizing: border-box;
    }

    /* 다중 줄 텍스트 트렁케이트 */
    .truncate-multiline {
      display: -webkit-box; /* Flex 기반의 줄 제한 */
      -webkit-box-orient: vertical; /* 줄 방향 설정 */
      overflow: hidden; /* 넘치는 텍스트 숨김 */
      text-overflow: ellipsis; /* ... 표시 */
      line-height: 1.5; /* 줄 간격 설정 */
      max-height: calc(1.5em * 4); /* 최대 4줄 높이로 제한 */
      -webkit-line-clamp: 4; /* 최대 줄 수 */
      box-sizing: border-box;
    }
  </style>
</head>
<body
    style="background-color: var(--light-color); font-family: var(--body-font),serif; color: var(--body-text-color);">
<div th:replace="~{fragments/header}"></div>
<section id="book-list" class="padding-medium">
  <div class="container">
    <div class="section-header align-center">
      <div class="title">
        <span>Explore Our Collection</span>
      </div>
      <h2 class="section-title">Book List</h2>
    </div>

    <!-- Search Form -->
    <form th:action="@{/book/search}" method="get" class="search-form">
      <div class="row justify-content-center mb-5">
        <div class="col-md-8">
          <div class="input-group d-flex align-items-center" style="gap: 10px; height: 40px;">
            <!-- 검색창 -->
            <input type="text" style="margin: 0; height: 66px" class="form-control search-input" name="keyword" placeholder="Search for books..."
                 th:value="${keyword ?: ''}">

            <!-- 검색 버튼 -->
            <button class="btn btn-accent search-btn" type="submit">Search</button>
          </div>
        </div>
      </div>
    </form>

    <!-- Book List -->
    <div class="row">
      <div class="products-grid d-flex flex-wrap" style="justify-content: flex-start; margin-top: 28px"> <!-- flexbox 컨테이너 설정 -->
        <div class="col-md-3" th:each="book : ${books}" style="margin-bottom: 20px;"> <!-- 추가된 스타일 -->
          <a th:href="'/book/' + ${book.bookId}" class="caption-link">
            <div class="product-item" style="margin: 0 10px;"> <!-- 좌우 간격 추가 -->
              <div class="product-image-container" style="height: 400px; width: 300px; display: block;">
                <!-- 책 이미지가 있는 경우 -->
                <img th:if="${book.imagePaths != null and book.imagePaths.length > 0}"
                     th:src="'https://image.toast.com/aaaacko/55gshop/book/thumbnails/'+${book.imagePaths[0]}"
                     alt="Thumbnail"
                     class="product-image"
                     style="height: 100%; width: 100%; object-fit: contain; display: block;">

                <!-- 책 이미지가 없는 경우 -->
                <img th:unless="${book.imagePaths != null and book.imagePaths.length > 0}"
                     th:src="@{/static/images/noImage.jpg}"
                     alt="Thumbnail"
                     class="product-image"
                     style="height: 100%; width: 100%; object-fit: contain; display: block;">
              </div>

              <section class="book-info">
                <h3 th:text="${book.title}" class="truncate-fixed">Book Title</h3>
                <span th:text="${book.description}" class="truncate-multiline">Description</span>
                <span th:text="${#temporals.format(book.publishedDate, 'yyyy-MM-dd')}" class="truncate-fixed">Published Date</span>
                <div class="item-price truncate-fixed" th:text="${book.price} + '원'">Price</div>
              </section>

            </div>
          </a>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="row justify-content-center mt-5">
      <nav class="d-flex justify-content-center"> <!-- 가운데 정렬 클래스 추가 -->
        <ul class="pagination">
          <!-- Previous Button -->
          <li class="page-item" th:classappend="${page <= 0} ? 'disabled' : ''">
            <a class="page-link" th:href="@{/book/search(page=${page > 0 ? page - 1 : 0})}"
               th:attr="aria-disabled=${page <= 0}"> < </a>
          </li>

          <!-- Page Numbers -->
          <th:block th:if="${totalPage > 0}">
            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPage - 1)}"
                th:classappend="${page == i} ? 'active' : ''">
              <a class="page-link" th:href="@{/book/search(page=${i})}" th:text="${i + 1}"></a>
            </li>
          </th:block>

          <!-- Next Button -->
          <li class="page-item" th:classappend="${page >= totalPage - 1} ? 'disabled' : ''">
            <a class="page-link" th:href="@{/book/search(page=${page < totalPage - 1 ? page + 1 : totalPage - 1})}"
               th:attr="aria-disabled=${page >= totalPage - 1}"> > </a>
          </li>
        </ul>
      </nav>
    </div>

  </div>
</section>
<div th:replace="~{fragments/footer}"></div>
</body>
</html>
